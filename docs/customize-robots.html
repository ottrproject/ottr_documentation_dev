<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Customizing Automatic Checks – OTTR </title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./resources/images/basic_otter_water.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-169b6d0432b1a799c6e7691d07d1a7fb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">OTTR <img src="./resources/images/basic_otter_water.PNG" width="35px"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text"><i class="fa-solid fa-home" title="A home" aria-label="home"></i></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quick-start" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Quick Start</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quick-start">    
        <li>
    <a class="dropdown-item" href="./getting_started.html">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./next_steps.html">
 <span class="dropdown-text">Next Steps</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-customization" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Customization</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-customization">    
        <li>
    <a class="dropdown-item" href="./customize-robots.html">
 <span class="dropdown-text">Customizing checks <i class="fa-solid fa-robot" title="A robot" aria-label="robot"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./customize-style.html">
 <span class="dropdown-text">Customizing style <i class="fa-solid fa-palette" title="A palette" aria-label="palette"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./customize-docker.html">
 <span class="dropdown-text">Customizing Docker <i class="fa-solid fa-gears" title="gears" aria-label="gears"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./more_features_sources.html">
 <span class="dropdown-text">Citing sources <i class="fa-solid fa-quote-left" title="A left quotation mark" aria-label="quote-left"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./more_features_credits.html">
 <span class="dropdown-text">Giving credits <i class="fa-solid fa-award" title="An award" aria-label="award"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./more_features_borrowing.html">
 <span class="dropdown-text">Borrowing chapters <i class="fa-solid fa-bookmark" title="A bookmark" aria-label="bookmark"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./more_features_gdoc.html">
 <span class="dropdown-text">Compatibility with Google Docs <i class="fa-solid fa-file" title="a file folder" aria-label="file"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./more_features_ganalytic.html">
 <span class="dropdown-text">Google Analytics <i class="fa-solid fa-chart-line" title="a line chart" aria-label="chart-line"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ottr-fy.html">
 <span class="dropdown-text">OTTR-fying an existing repository</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./examples.html">
 <span class="dropdown-text">About OTTR babies</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./faqs.html"> 
<span class="menu-text">Troubleshooting <i class="fa-solid fa-tools" title="tools" aria-label="tools"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./contact.html"> 
<span class="menu-text">Contact <i class="fa-solid fa-envelope" title="An envelope" aria-label="envelope"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ottrproject/OTTR_Template"> 
<span class="menu-text"><i class="fa-brands fa-github" title="The GitHub logo" aria-label="github"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pull-request-checks" id="toc-pull-request-checks" class="nav-link active" data-scroll-target="#pull-request-checks">Pull Request Checks:</a>
  <ul class="collapse">
  <li><a href="#check-quiz-formatting" id="toc-check-quiz-formatting" class="nav-link" data-scroll-target="#check-quiz-formatting">Check Quiz Formatting</a></li>
  <li><a href="#check-for-broken-urls" id="toc-check-for-broken-urls" class="nav-link" data-scroll-target="#check-for-broken-urls">Check for broken URLs</a></li>
  <li><a href="#preview-rendering" id="toc-preview-rendering" class="nav-link" data-scroll-target="#preview-rendering">Preview rendering</a></li>
  <li><a href="#spell-checking" id="toc-spell-checking" class="nav-link" data-scroll-target="#spell-checking">Spell checking</a></li>
  <li><a href="#style-code" id="toc-style-code" class="nav-link" data-scroll-target="#style-code">Style code</a></li>
  <li><a href="#docker-testing" id="toc-docker-testing" class="nav-link" data-scroll-target="#docker-testing">Docker testing</a></li>
  </ul></li>
  <li><a href="#rendering-actions" id="toc-rendering-actions" class="nav-link" data-scroll-target="#rendering-actions">Rendering actions</a></li>
  <li><a href="#manually-running-rendering-or-checks" id="toc-manually-running-rendering-or-checks" class="nav-link" data-scroll-target="#manually-running-rendering-or-checks">Manually running rendering or checks</a></li>
  <li><a href="#fixing-broken-github-actions" id="toc-fixing-broken-github-actions" class="nav-link" data-scroll-target="#fixing-broken-github-actions">Fixing broken GitHub Actions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Customizing Automatic Checks</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>By default, all automation steps and checks will run. Based on the requirements of your course, you have the flexibility to enable or disable specific features by modifying the settings in the <code>config_automation.yml</code> file. Simply adjust the options to “true” or “false” accordingly.</p>
<p>The <code>config_automation.yml</code> file looks like this:</p>
<pre><code>### Render preview of content with changes (Rmd's and md's are checked)
render-preview: true

##### Checks run at pull request #####
# Check quiz formatting
check-quizzes: false
quiz_error_min: 0
# Check that urls in the content are not broken
url-checker: true
url_error_min: 0
# Spell check Rmds and quizzes
spell-check: true
spell_error_min: 0

#### Other options
# Style any R code
style-code: true
# Would you like your markdown files to be checked for formatting
markdown-linter: true
# Would you like a readability report on your markdowns?
readability-report: true
# Test build the docker image if any docker-relevant files have been changed
docker-test: false
# Should URLs be tested periodically?
url-check-periodically: true

##### Renderings run upon merge to main branch #####
# Rendering each platform's content
render-website: rmd
render-leanpub: true
render-coursera: true

## Automate the creation of Book.txt file? yes/no
## This is only relevant if render-leanpub is yes, otherwise it will be ignored
make-book-txt: true

# What docker image should be used for rendering?
# The default is jhudsl/base_ottr:main
rendering-docker-image: 'jhudsl/base_ottr:main'</code></pre>
<p>There are three main sets of automation steps and checks run:</p>
<ul>
<li><code>.github/workflows/pull-request.yml</code> : Run upon opening a pull request</li>
<li><code>.github/workflows/render-all.yml</code>: Run upon any changes merged to the <code>main</code> branch</li>
<li><code>.github/workflows/check-url.yml</code>: Run checks of URLs in a OTTR repo periodically to see if any are no longer valid</li>
</ul>
<section id="pull-request-checks" class="level2">
<h2 class="anchored" data-anchor-id="pull-request-checks">Pull Request Checks:</h2>
<p>These actions are triggered upon a pull request being opened. They are set up in this file: <code>.github/workflows/pull-request.yml</code></p>
<section id="check-quiz-formatting" class="level3">
<h3 class="anchored" data-anchor-id="check-quiz-formatting">Check Quiz Formatting</h3>
<p>In the <code>config_automation.yml</code> file it is set by:</p>
<pre><code>check-quizzes: false</code></pre>
<p>By default, it is set to <code>false</code>. But if you wish to <a href="https://www.ottrproject.org/course_publishing.html#publishing-with-leanpub">create quizzes on Leanpub</a>, you should set this to <code>true</code>. This is not necessary if you only want quizzes for Coursera. Leanpub needs a particular format for it to upload correctly. This action will look for quizzes in the <code>quizzes</code> directory and check for these items. The outcome of these quiz checks will be printed to a GitHub comment on your pull request.</p>
</section>
<section id="check-for-broken-urls" class="level3">
<h3 class="anchored" data-anchor-id="check-for-broken-urls">Check for broken URLs</h3>
<p>In the <code>config_automation.yml</code> file there are two different URL checkers.</p>
<ol type="1">
<li>One that is run during pull requests. It is set by:</li>
</ol>
<pre><code>url-checker: true</code></pre>
<p>GitHub Actions runs a check on all the URLs upon creating a pull request to the <code>main</code> branch. If it fails, you can click on the output comment on your pull request that says “Click here to download detailed error reports”. This will download a zip file containing a list of the broken URLs it found.</p>
<p>If you don’t set the additional error threshold option in the config_automation file, the check summary may still report that the URL check failed, even if 0 errors were found.</p>
<pre><code>url_error_min: 0</code></pre>
<ol start="2" type="1">
<li>The other URL check runs on a set interval to see if any URLs referenced are no longer valid. This one is set by:</li>
</ol>
<pre><code>url-check-periodically: true</code></pre>
<p>If either URL checker is failing on something that isn’t really a URL or doesn’t need to be checked, open the <code>resources/ignore-urls.txt</code> file and add that URL exactly as it is specified in the error print out. After committing the changes to <code>resources/ignore-urls.txt</code> on your branch, the url check status check should be successfully passed.</p>
</section>
<section id="preview-rendering" class="level3">
<h3 class="anchored" data-anchor-id="preview-rendering">Preview rendering</h3>
<p>In the <code>config_automation.yml</code> file it is set by:</p>
<pre><code>render-preview: true</code></pre>
<p>After you open a pull request, a preview of the renders will be linked in an automatic comment on the pull request. Upon each commit these previews will re-render and edit the comment with the latest render.</p>
<p><img src="https://raw.githubusercontent.com/ottrproject/ottrproject.github.io/main/resources/screenshots/check_results.png" class="img-fluid"></p>
<p>These Github Actions are located in <code>render-preview</code> section of the <code>pull-request.yml</code>. These previews do NOT incorporate any changes influenced by any changes to the Docker image if the Dockerfile is also updated in the same pull request.</p>
</section>
<section id="spell-checking" class="level3">
<h3 class="anchored" data-anchor-id="spell-checking">Spell checking</h3>
<p>In the <code>config_automation.yml</code> file it is set by:</p>
<pre><code>spell-check: true</code></pre>
<p>Github Actions will automatically run a spell check on all Rmds and mds whenever a pull request to the <code>main</code> branch is filed.</p>
<p>The error threshold option controls how many errors are allowed before the check will fail.</p>
<pre><code>spell_error_min: 0</code></pre>
<p>You’ll need to resolve those before being able to merge your pull request. Errors are displayed in much the same way as PR URL check errors with a summary of how many errors are found. Click on the output comment on your pull request that says “Click here to download detailed error reports”. This will download a zip file containing a list of the spelling errors it found.</p>
<p>Some of these errors may be things that the spell check doesn’t recognize for example: <code>ITCR</code> or <code>DaSL</code>. If it’s a ‘word’ the spell check should recognize, you’ll need to add this to the dictionary.</p>
<p>Go to the <code>resources/dictionary.txt</code> file. Open the file and add the new ‘word’ to its appropriate place (the words are in alphabetical order). After committing the changes to <code>resources/dictionary.txt</code> on your branch, the spell check status check should be successfully passed.</p>
<p>The PR comment included below shows an example of a check that passed (spell check), and a check that failed (the URL check) with the option to download detailed error report(s).</p>
<p><img src="https://raw.githubusercontent.com/ottrproject/ottrproject.github.io/main/resources/screenshots/check_results.png" class="img-fluid"></p>
<p>When all checks pass, the option to download error reports is no longer included, instead displaying a message that the URL and spell checks passed.</p>
<p><img src="https://raw.githubusercontent.com/ottrproject/ottrproject.github.io/main/resources/screenshots/check_results_pass.png" class="img-fluid"></p>
</section>
<section id="style-code" class="level3">
<h3 class="anchored" data-anchor-id="style-code">Style code</h3>
<p>In the <code>config_automation.yml</code> file it is set by:</p>
<pre><code>style-code: true</code></pre>
<p>The <code>styler</code> package will style R code in all Rmds. Style changes will automatically be committed back to your branch.</p>
</section>
<section id="docker-testing" class="level3">
<h3 class="anchored" data-anchor-id="docker-testing">Docker testing</h3>
<p>In the config_automation.yml file it looks like:</p>
<pre><code>docker-test: false</code></pre>
<p>By default it is set to <code>false</code> which means it won’t run automatically unless you change this to <code>true</code>. This is only relevant if you have <a href="https://www.ottrproject.org/customize-docker.html">your own Docker image you are managing for your course</a>. If changes are made to Docker-relevant files: <code>Dockerfile</code>, <code>install_github.R</code>, or <code>github_package_list.tsv</code>, this will test re-build the Docker image. If it is successfully built, then it makes sense to merge it to <code>main</code> but the Docker Image will not be pushed to <code>Dockerhub</code> automatically. <a href="https://www.ottrproject.org/customize-docker.html#Testing_a_modified_Docker_image">Follow these instructions to push your Docker image to Dockerhub</a>.</p>
<p><br></p>
</section>
</section>
<section id="rendering-actions" class="level2">
<h2 class="anchored" data-anchor-id="rendering-actions">Rendering actions</h2>
<p>Upon merging changes to any <code>Rmd</code> or <code>assets/</code> folder to <code>main</code>, the course material will be automatically re-rendered.</p>
<p>For rendering a website version of the course (or your website), rather than <code>true</code> or <code>false</code>, the options are <code>rmd</code>, <code>rmd_web</code>, <code>quarto</code> or <code>quarto_web</code>.</p>
<ul>
<li>If rendering a course with RMarkdown files, use <code>rmd</code>.</li>
<li>If rendering a course with quarto files, use <code>quarto</code>.</li>
<li>If rendering a website with RMarkdown files, use <code>rmd_web</code>.</li>
<li>If rendering a website with quarto files, use <code>quarto_web</code>.</li>
</ul>
<pre><code>render-website: rmd</code></pre>
<p>By default, all rendering steps will be run. But depending on the needs of your course, you can turn these on and off by going to the <code>config_automation.yml</code> file and switching options to <code>true</code> or <code>false</code>.</p>
<pre><code>render-leanpub: true
render-coursera: true</code></pre>
<p>For publishing to Leanpub, make sure that the render Leanpub option is set to true: <code>render-leanpub: true</code>. See more details about publishing to Leanpub <a href="https://www.ottrproject.org/course_publishing.html#publishing-with-leanpub">here</a>.</p>
<p>If render-leanpub is true, the <code>make-book-txt</code> option is also relevant. This option controls whether you’d like to manually specify the order of your chapters and quizzes by creating the <a href="https://leanpub.com/lfm/read#leanpub-auto-the-booktxt-file">Book.txt file</a> by hand or whether you’d like this to be <a href="https://ottrproject.org/ottrpal/#about-the-booktxt-file">automatically generated based on file and quiz numbering.</a>. Read more about this <a href="https://www.ottrproject.org/examples.html#Setting_up_quizzes">in the upcoming section</a>.</p>
<p>By default, <code>make-book-txt: true</code> will use the numbering in the names of the documents for chapters and quizzes to order them, but if you’d like to specify the order for the chapters and quizzes to be different on Leanpub, then set this to <code>make-book-txt: false</code>, so as not to override the book.txt file that you would make manually.</p>
<pre><code>make-book-txt: true</code></pre>
<p>For publishing to Coursera, make sure render Coursera option is set to true: <code>render-coursera: true</code>. See more details about publishing to Coursera <a href="https://www.ottrproject.org/course_publishing.html#publishing-with-coursera">here</a>.</p>
<p><br></p>
</section>
<section id="manually-running-rendering-or-checks" class="level2">
<h2 class="anchored" data-anchor-id="manually-running-rendering-or-checks">Manually running rendering or checks</h2>
<p>From time to time, it may be useful to manually re-trigger a particular GitHub Action. Most of the GitHub Actions, particularly the rendering ones, can be re-run manually. See this article about <a href="https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow#running-a-workflow">how to manually re-run a GitHub Action</a>.</p>
<p><br></p>
</section>
<section id="fixing-broken-github-actions" class="level2">
<h2 class="anchored" data-anchor-id="fixing-broken-github-actions">Fixing broken GitHub Actions</h2>
<p>GitHub action rendering or other GitHub actions may fail sometimes if the input is unexpected or for a number of other reasons. To investigate why a GitHub action has failed, go to <code>Actions</code> and click on the failed action. <a href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#viewing-the-workflows-activity">See this article for how to find this information</a>.</p>
<p>See our <a href="./faqs.html">FAQ’s section</a> for the most commonly encountered errors and how to address them.</p>
<p>If you are unsure what the error message means and have trouble addressing it, please <a href="https://github.com/ottrproject/OTTR_Template/issues/new?assignees=cansavvy&amp;labels=bug&amp;template=course-template-problem-report.md">file an issue on the OTTR_Template repository to get help</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>